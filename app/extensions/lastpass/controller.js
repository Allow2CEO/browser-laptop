LPProxy={};
(function(){var O=null,L=Strings.translateString("(none)");Topics.get(Topics.CLEAR_DATA).subscribe(function(){k=null;LPProxy.clearModel()});LPProxy.getBaseURL=function(){return bg.base_url};LPProxy.logEvent=function(a){bg.lpevent(a)};LPProxy.encryptAES=function(a,b){return 0<a.length?bg.AES.Encrypt({pass:b,data:a,b64:!0,bits:256}):a};LPProxy.decryptAES=function(a,b){return bg.AES.Decrypt({pass:b,data:a,b64:!0,bits:256})};var j=function(a){return function(b,c,d){a(d)}},p=function(a,b){return function(c){try{switch(c){case "exceededlimit":a(Strings.translateString("Sorry, as a premium user, you are limited to one Shared Folder. Please consider using %1 if you would like more.",{type:"a",
attributes:{target:"_blank",href:LPProxy.getBaseURL()+"enterprise/"},text:"LastPass Enterprise"}));break;default:var d=$(jQuery.parseXML(c));da(d,a,b)}}catch(e){LPPlatform.logException(e),a(Strings.Vault.UNEXPECTED_ERROR)}}},D=function(a,b,c){a=a[b];return"function"===typeof a?(a(c),!0):!1},da=function(a,b,c){var d=a.find("result"),e=a.find("ok"),f=a.find("error"),g=a.find("failed");if(d.length){var e=d.attr("rc"),f=d.attr("msg"),g=d.attr("success"),h=d.attr("ok"),l=d.text().trim();if(void 0!==e){a=
c[e];if("function"===typeof a){a(d);return}switch(e){case "notoken":b("No token was provided. Request could not be completed");return;case "cantsharewithself":b("Cannot share an item with yourself.");return;case "alreadyexists":b(Strings.translateString("That group already exists."));return}}else if(void 0!==f){if(D(c,f,d))return}else if(void 0!==g){if(D(c,g,d))return}else if(void 0!==h){if(D(c,"ok"))return}else if("ok"===l){if(D(c,"ok")||D(c,a.find("status").text()))return}else if("bad"===l){b(a.find("message").text());
return}}else if(e.length){if(D(c,"ok",e))return}else if(f.length){if(d=f.attr("message")){b(d);return}}else if(g.length&&D(c,g.attr("reason"),g))return;b(Strings.Vault.UNEXPECTED_ERROR)},m=function(a,b){return function(c){try{c=jQuery.parseJSON(c);if("object"===typeof b){var d=b[c.error]||b[c.res]||b[c.reason]||b[c.status];if("function"===typeof d){d(c);return}b=b["default"]}if(c.error)switch(c.error){case "session_expired":a(Strings.translateString("ErrorSessionMsg"));return;case "not_allowed":a(Strings.translateString("Your Shared Folder action failed. Please check your permissions before trying again"));
return;default:a(c.errortxt||Strings.Vault.UNEXPECTED_ERROR);return}if(c.res)switch(c.res){case "success":break;default:a(Strings.Vault.UNEXPECTED_ERROR);return}b(c)}catch(e){LPPlatform.logException(e),a(Strings.Vault.UNEXPECTED_ERROR)}}},s=function(a){return function(){bg.have_binary()?a.apply(this,arguments):dialogs.confirmation.open({title:Strings.translateString("Install Binary Component"),text:Strings.translateString("This feature requires the binary version of this browser extension. Would you like to install it now?"),
handler:function(){bg.install_binary()}})}};LPProxy.logout=function(){bg.lpevent("v_off");bg.loggedOut(!1,"homelocal2")};LPProxy.copyUsername=function(a){bg.lpevent("v_cu");bg.copytoclipboard(a.getUsername())};LPProxy.copyPassword=function(a){bg.lpevent("v_cp");bg.copytoclipboard(a.getPassword());bg.loglogin(a.getID())};LPProxy.copyURL=function(a){bg.lpevent("v_curl");bg.copytoclipboard(a.getURL())};LPProxy.goToURL=function(a){bg.lpevent("v_g2");bg.openURL(a.getURL())};LPProxy.copyToClipboard=function(a){bg.copytoclipboard(a)};
var H=function(a){for(var b=[],c=0,d=a.length;c<d;++c)"0"!==a[c].getID()&&b.push(a[c].getID(!0));return b.join(",")};LPProxy.deleteItem=function(a,b){bg.lpevent("v_d");bg.deleteAid(H(a),window,!0,!0,b)};LPProxy.deleteFormFill=function(a,b,c){bg.lpevent("v_dff");bg.deleteformfill(a._data.ffid,!0,!1,null,b,c)};LPProxy.deleteFolder=function(a,b){bg.lpevent("v_dg");bg.deleteAid(H(a),window,!0,!0,b)};LPProxy.launchSite=function(a){bg.lpevent("v_ls");bg.launch(a.getID(),!0)};LPProxy.launchApplication=s(function(a){bg.launchApp(a.getID())});
LPProxy.moveToFolder=function(a,b,c,d){bg.moveSelectedToGroup(b._data.group,H(a),{skipConfirm:!0},c,d)};LPProxy.convertToSharedFolder=function(a,b,c,d){for(var e=[],f=0,g=a.length;f<g;++f){var h=a[f];e[h.getID()]=SharedGroup.prototype.SHARED_FOLDER_NAME_PREFIX+h._data.group}LPProxy.createSharedFolder(b,function(){Topics.get(Topics.UPDATE_VAULT_STATE).publish({incrementAccountsVersion:!0,incrementAccountsVersionAmount:2});var f=b._shareInfo.sharekey;b._shareInfo.sharekey=b._shareInfo.key;bg.moveIntoSharedFolder(b._shareInfo,
!1,P(a),e,!1,!1,!0,{successCallback:function(){b._shareInfo.sharekey=f;c()},errorCallback:d})},d)};LPProxy.addGroup=function(a,b,c){bg.addEmptyGroup(a._data.group,b,c)};LPProxy.renameGroup=function(a,b,c,d){bg.renameGroup(a._data.group,b.group,{skipConfirm:!0},c,d)};var n=function(a){return function(){var b=arguments;LPProxy.getToken(function(){a.apply(window,b)},arguments[arguments.length-1])}},r,ea=function(a){a?dialogs.alert.open({title:Strings.translateString("Generating Sharing Keys"),text:Strings.translateString("LastPass is currently generating unique sharing keys required for this action. Please try again later.")}):
dialogs.sharingKey.open()};r=function(a){return function(){for(var b=[],c=0,d=arguments.length;c<d;++c)b.push(arguments[c]);var e=b[b.length-1],f=new SharedFolderUser({uid:bg.g_uid,username:bg.g_username});LPProxy.getPublicKeys([f],function(){f.pubkey?(b.push(f),a.apply(window,b)):(LPPlatform.generateSharingKeys(ea),e())},e)}};var J=function(a,b){for(var c=[],d=0,e=a.length;d<e;++d){var f=a[d];f&&c.push({email:f,reason:b})}return c},fa=function(a){var b=J([a.withself],Strings.translateString("You can not share with yourself.")),
b=b.concat(J(a.rowsINV,Strings.translateString("Invalid email address."))),b=b.concat(J(a.rowsUNS,Strings.translateString("The user must login to LastPass at least once to permit sharing."))),b=b.concat(J(a.rowsSPA,Strings.translateString("The user does not want to receive emails from LastPass."))),b=b.concat(J(a.rowsRES,Strings.translateString("Sharing is restricted by a LastPass Enterprise policy.")));a=LPTools.createElement("table","settings dialogMargin");var c=LPTools.createElement("tr","settingsHeader");
c.appendChild(LPTools.createElement("th",null,Strings.translateString("Email Address")));c.appendChild(LPTools.createElement("th",null,Strings.translateString("Reason")));a.appendChild(c);for(var c=0,d=b.length;c<d;++c){var e=b[c],f=LPTools.createElement("tr","settingsRow"+(0!==c%2?" odd":""));f.appendChild(LPTools.createElement("td",null,e.email));f.appendChild(LPTools.createElement("td",null,e.reason));a.appendChild(f)}dialogs.alert.open({title:Strings.translateString("Failed To Share With Some Users"),
text:[Strings.translateString("We failed to share with the following users:"),a]})},ga=function(a){dialogs.inviteFriends.open(a)},ha=function(a,b){b.error(Strings.translateString("Please enter at least one email and try again."))},ia=function(a,b){dialogs.verifyEmail.open({email:bg.g_username});b.error()},ja=function(a,b){var c=LPServer.getRecordsFromResponse(a,"email",LPServer.getAttrInt(a,"numinvalid",0));b.error(Strings.translateString("The following emails are invalid: %1",c.join(", ")))},ka=
function(a,b){var c=LPServer.getAttrInt(a,"numexcess");"1"===c?b.error(Strings.translateString("You are trying to share with too many people.  Please remove at least %1 email and try again.",c)):b.error(Strings.translateString("You are trying to share with too many people.  Please remove at least %1 emails and try again.",c))},la=function(a,b){b.error(Strings.translateString("You can not share with yourself."))};LPProxy.shareItems=function(a){a.callbacks={problems:fa,invite:ga,noemailspecified:ha,
toomanyemails:ka,usernameisnotvalidemail:ja,"Please first verify your email.":ia,cantsharewithself:la};a.success=LPServer.extendCallback(a.success,function(a){Topics.get(Topics.SUCCESS).publish("Share sent to "+LPServer.getAttrInt(a,"numemails",0)+" recipients");Topics.get(Topics.ITEM_SHARED).publish()});bg.BackgroundServer.sharing.individual.shareItems(a)};LPProxy.resendShareInvitation=function(a){bg.BackgroundServer.sharing.individual.shareItems(a)};LPProxy.unshareItem=function(){bg.BackgroundServer.sharing.individual.unshareItem.apply(bg,
arguments)};LPProxy.acceptShare=function(){bg.BackgroundServer.sharing.individual.acceptShare.apply(bg,arguments)};LPProxy.rejectShare=function(){bg.BackgroundServer.sharing.individual.rejectShare.apply(bg,arguments)};LPProxy.renameSharedGroup=n(function(a,b,c,d){var e={update:1,rename:1};e.id=a.getID();e.name=a.getShareGroupName(b.group);e.sharename=bg.enccbc(b.group,a.getKey());e.token=k;e.xmlr=1;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:e,dataType:"text",success:p(d,
{ok:c}),error:j(d)})});LPProxy.parsePrivateKey=function(a){bg.parse_private_key(a,bg.rsaprivatekeyhex)};LPProxy.parsePublicKey=function(a,b){bg.parse_public_key(a,b)};LPProxy.encrypt=function(a,b){return bg.enc(a,b)};LPProxy.decrypt=function(a,b){try{return bg.dec(a,b)}catch(c){return""}};LPProxy.getLocalKey=function(){return null!==bg?bg.g_local_key:""};LPProxy.encryptWithKey=function(a,b){return null!==bg?bg.lpenc(a,b):a};LPProxy.encryptWithBTOA=function(a){return null!==bg?bg.crypto_btoa(a):a};
LPProxy.encryptMobile=function(a,b,c){return null!==bg?bg.lpmenc(a,b,c):a};LPProxy.decryptMobile=function(a,b,c){return null!==bg?bg.lpmdec(a,b,c):a};var E,Q=function(a,b,c,d,e,f){a._data.save_all&&a.isNew()?bg.saveAllSite(a.getURLArguments(b,c,d),a._data,e,f):bg.saveSite(a.getURLArguments(b,c,d),b,e,f)};E=function(a,b,c,d,e,f){if(b.attacharraychanges&&b.attacharraychanges.add&&0<b.attacharraychanges.add.length){var g=bg.AES.hex2bin(bg.lpdec(b.attachkey,c.getKey()));if(!g)throw new AttachmentKeyException;
bg.fastEncryptAttachments(g,b.attacharraychanges.add,function(g){for(var l=0,v=g.length;l<v;++l)b.attacharraychanges.add[l].bytes=g[l].data;Q(a,b,c,d,e,f)})}else Q(a,b,c,d,e,f)};LPProxy.saveSite=function(a,b,c,d,e,f){var g=e;if(b.fieldsChanged){for(var g={aid:a.getID(),urid:0,auto:1,update:1},h=$.param(g),l={},g=0;g<b.fields.length;++g){var v=b.fields[g];if("checkbox"!=v.type||v.checked){var j=a.getFieldPostData(v),k="_"+v.name;v.otherfield&&void 0!==v.formname&&(k="_"+v.formname+k);l[k]=j.value}}if(g=
a.getShareInfo())l.sharedfolderid=g.id;l=$.param(l);g=function(){bg.saveFields(h,l,{aid:a.getID()},e,f)}}E(a,b,c,d,g,f)};LPProxy.addSite=function(a,b,c,d,e){LPTools.getOption(c,"saveFromSubmit",!1)?bg.saveSiteFromSubmit(a.getURLArguments(a._data,b,c),a._data,d,e):E(a,a._data,b,c,d,e)};LPProxy.saveNote=function(a,b,c,d,e,f){E(a,b,c,d,e,f)};LPProxy.addNote=function(a,b,c,d,e){E(a,a._data,b,c,d,e)};LPProxy.saveApplication=function(a,b,c,d,e,f){E(a,b,c,d,e,f)};LPProxy.addApplication=function(a,b,c,d,
e){E(a,a._data,b,c,d,e)};LPProxy.addFormFill=function(a,b,c){var d=a.getPostData(a._data);d.cmd=a._data.cmd="add";bg.addeditformfill(d,a._data,b,c)};LPProxy.saveFormFill=function(a,b,c,d){a=a.getPostData(b);a.cmd=b.cmd="edit";bg.addeditformfill(a,b,c,d)};LPProxy.getShareInfo=function(a){var b=null;$.each(bg.g_shares,function(c,d){if(d.id===a)return b=d,!1});return b};LPProxy.getImage=function(a){var b=!0,c=bg.getbigicon(a._model.getURL());null===c&&(b=!1,c=bg.geticonurlfromrecord(a._model._data,!0));
a.bigImg=b;return c};var R=function(a){for(var b in a)if(a[b].isReceivedShare())return!0;return!1};LPProxy.hasReceivedShares=function(){return 0<bg.g_pendings.length||R(t)||R(w)};LPProxy.getPendingRecievedShares=function(){var a=[];if(LPTools.hasProperties(y))if(bg.rsaprivatekeyhex){var b=0,c;for(c in y)try{a.push(y[c].newDisplayObject())}catch(d){++b}0<b&&Topics.get(Topics.ERROR).publish(Strings.translateString("%1 Pending Shares could not be decrypted.",b))}else Topics.get(Topics.ERROR).publish(Strings.translateString("No private key. Cannot decrypt Pending Shares."));
return a};LPProxy.getPendingRecievedShare=function(a){return y[a]};LPProxy.getEmergencyAccessRecipientModels=function(){var a=[],b;for(b in z)a.push(z[b]);return a};LPProxy.getEmergencyAccessRecipientModel=function(a){return z[a]};LPProxy.assignItemsToGroups=function(a,b){var c={},d;for(d in q)c[d]=q[d].newDisplayObject();b="undefined"===typeof b?!0:b;d=0;for(var e=a.length;d<e;++d){var f=a[d],g=f._model._data.group||L,h=c[g];if(void 0===h){for(var h=LPProxy.addDummyGroups(f._model,!1),l=0,v=h.length;l<
v;++l){var j=h[l];c[j.getName()]=j.newDisplayObject()}h=c[g]}h._items.push(f);f.setParent(h)}for(var k in c)if(d=c[k],e=d._model.getGroupParentName())e=c[e],void 0!==e&&null===d._parent&&(e._subGroups.push(d),d.setParent(e));k=[];for(var n in c)d=c[n],d._destructed||(!b&&0===d.getItemChildren().length?d.destruct():null===d._parent&&k.push(d));return k};var S=function(a,b){var c=null;null!==a&&(c=bg.g_identity,void 0!==a&&(c=a.getID()));var d=null;null!==c&&$.each(bg.g_identities,function(a,f){if(f.iid===
c){d={};for(var g=f[b].split(","),h=0;h<g.length;++h)d[g[h]]=!0;return!1}});return d};LPProxy.getAllModelItems=function(){return LPTools.objectsToArray(t,w,u)};LPProxy.getAllSharedGroupModelsByID=function(){return $.extend({},x)};LPProxy.getAllItems=function(a){var b=LPProxy.getSites(a).concat(LPProxy.getNotes(a)).concat(LPProxy.getApplications(a)),c=!0;a&&a.identity instanceof Identity&&(c=a.identity instanceof AllIdentity);return LPProxy.assignItemsToGroups(b,c).concat(LPProxy.getFormFills(a))};
LPProxy.getApplicationModel=function(a){return C[a]};LPProxy.getApplications=function(a){return M(C,"appaids",a)};var t={},w={},u={},C={},x={},F={},y={},I={},z={},q={},T=function(a){if(a instanceof Account)return t;if(a instanceof Note)return w;if(a instanceof FormFill)return u;if(a instanceof Application)return C;if(a instanceof SharedGroup)return x;if(a instanceof Group)return F;if("undefined"!==typeof PendingReceivedSharedItem&&a instanceof PendingReceivedSharedItem)return y;if("undefined"!==typeof EmergencyAccessRecipient&&
a instanceof EmergencyAccessRecipient)return z;if("undefined"!==typeof EmergencyAccessSharer&&a instanceof EmergencyAccessSharer)return I};LPProxy.removeItem=function(a){var b=T(a);b&&delete b[a.getID()];a instanceof Group&&delete q[a.getName()]};LPProxy.addItem=function(a){var b=T(a);b&&(b[a.getID()]=a);a instanceof Group&&(q[a.getName()]=a)};LPProxy.getExistingGroupParent=function(a){for(;0<a.length;)if(void 0===q[a])a=a.substring(0,a.lastIndexOf("\\"));else return q[a];return null};var U=function(a,
b,c,d){a=new a(b,d);if(void 0===c||c)q[a.getName()]=a;return a};LPProxy.addDummyGroups=function(a,b){var c=a.getSharedGroup(),d=a._data.group,e=[];a instanceof DummyGroup&&(q[a.getName()]=a);if(d){var f=-1;do{var f=d.indexOf("\\",f+1),g=d.substring(0,-1===f?d.length:f);void 0===q[g]&&e.push(U(DummyGroup,g,b,c))}while(-1<f)}else void 0===q[L]&&e.push(U(DefaultGroup,L,b));return e};LPProxy.clearModel=function(){t={};w={};u={};C={};F={};x={};q={};y={};I={};z={}};var A=function(a,b){for(var c in a)if(void 0===
b[c]){var d=a[c];d.deleteUpdates(!1);d.removed=!0}},V=function(a){for(var b in a){var c=a[b];q[c.getName()]=c}},K=function(a){for(var b in a)LPProxy.addDummyGroups(a[b])};LPProxy.initializeModel=function(){q={};var a={},b={};if(bg.g_emer_sharers&&"undefined"!==typeof EmergencyAccessSharer)for(var c=0,d=bg.g_emer_sharers.length;c<d;++c){var e=bg.g_emer_sharers[c],f=e.username,g=I[f];I[f]=g=g?g.refresh(e):new EmergencyAccessSharer(e);a[f]=!0;g.allowedAccess()&&(b[g.getName()]=!0)}A(I,a);a={};if(bg.g_emer_sharees&&
"undefined"!==typeof EmergencyAccessRecipient){c=0;for(d=bg.g_emer_sharees.length;c<d;++c)e=bg.g_emer_sharees[c],f=e.username,g=z[f],z[f]=g?g.refresh(e):new EmergencyAccessRecipient(e),a[f]=!0}A(z,a);(a=bg.get_personal_linked())?Topics.get(Topics.ACCOUNT_LINKED).publish():Topics.get(Topics.ACCOUNT_UNLINKED).publish();var c={},h;for(h in bg.g_sites)d=bg.g_sites[h],"http://group"===d.url&&d.sharefolderid===h&&(e=LPProxy.getShareInfo(h),f=x[h],h===a?O=f=f?f.refresh(d,e):new LinkedGroup(d,e):b[d.group]?
f=f?f.refresh(d,e):new EmergencyAccessGroup(d,e):b[d.group.substring(SharedGroup.prototype.SHARED_FOLDER_NAME_PREFIX.length)]?(d.group=d.group.substring(SharedGroup.prototype.SHARED_FOLDER_NAME_PREFIX.length),f=f?f.refresh(d,e):new EmergencyAccessGroup(d,e)):f=f?f.refresh(d,e):new SharedGroup(d,e),x[h]=f,c[h]=!0);A(x,c);V(x);b={};h={};for(var l in bg.g_sites)if(a=bg.g_sites[l],c=x[a.sharefolderid],"http://group"===a.url){if(void 0===c||-1<a.group.indexOf("\\"))d=(d=F[l])?d.refresh(a,c):new Group(a,
c),F[l]=d,h[l]=!0}else d=t[l],t[l]=d?d.refresh(a,c):new Account(a,c),b[l]=!0;A(t,b);A(F,h);V(F);K(F);K(t);l={};for(var j in bg.g_securenotes){b=bg.g_securenotes[j];h=[];if("1"===b.attachpresent){a=0;for(c=bg.lp_attaches.length;a<c;++a)d=bg.lp_attaches[a],d.parent===b.aid&&h.push(new Attachment(d))}a=x[b.sharefolderid];c=w[j];w[j]=c?c.refresh(b,a,h):new Note(b,a,h);l[j]=!0}A(w,l);K(w);j={};for(var k in bg.g_applications)l=bg.g_applications[k],b=C[k],h=x[l.sharefolderid],C[k]=b?b.refresh(l,h):new Application(l,
h),j[k]=!0;A(C,j);K(C);k={};j=0;for(l=bg.g_formfills.length;j<l;++j)b=bg.g_formfills[j],h=b.ffid,a=u[h],c=x[b.sharefolderid],u[h]=a?a.refresh(b,c):new FormFill(b,c),k[h]=!0;A(u,k);k={};if("undefined"!==typeof PendingReceivedSharedItem){j=0;for(l=bg.g_pendings.length;j<l;++j)b=bg.g_pendings[j],h=b.id,a=y[h],y[h]=a?a.refresh(b):new PendingReceivedSharedItem(b),k[h]=!0}A(y,k);bg.refreshGroupNames()};LPProxy.getModel=function(a,b){switch(b){case "Account":return LPProxy.getSiteModel(a);case "Note":return LPProxy.getNoteModel(a);
case "FormFill":return LPProxy.getFormFillModel(a);case "Application":return LPProxy.getApplicationModel(a)}};LPProxy.getGroups=function(){return LPTools.objectsToArray(q)};LPProxy.getGroupByName=function(a){return q[a]};var M=function(a,b,c){var d=LPTools.getOption(c,"identity",void 0);b=LPTools.getOption(c,"filter",S(d,b));c=LPTools.getOption(c,"invertIdentity",!1)||LPTools.getOption(c,"invertFilter",!1);d=[];if(b&&!c)for(var e in b){if(!b||b[e]&&!c||void 0===b[e]&&c){var f=a[e];f&&d.push(f.newDisplayObject())}}else for(f in a)(!b||
b[f]&&!c||void 0===b[f]&&c)&&d.push(a[f].newDisplayObject());return d};LPProxy.getSiteModel=function(a){return t[a]};LPProxy.getSiteModels=function(){return LPTools.objectsToArray(t)};LPProxy.getSite=function(a){return(a=t[a])?a.newDisplayObject():null};LPProxy.getSites=function(a){return M(t,"aids",a)};LPProxy.getNoteModel=function(a){return w[a]};LPProxy.getNote=function(a){return(a=w[a])?a.newDisplayObject():null};LPProxy.getNotes=function(a){return M(w,"aids",a)};LPProxy.getItemsByShareID=function(a){for(var b=
[],c=LPProxy.getAllModelItems(),d=0,e=c.length;d<e;++d){var f=c[d];f.getShareID()===a&&b.push(f)}return b};LPProxy.getFormFillModel=function(a){return u[a]};LPProxy.getFormFillModels=function(){var a=[],b;for(b in u)a.push(u[b]);return a};LPProxy.getFormFill=function(a){return(a=u[a])?a.newDisplayObject():null};LPProxy.getFormFills=function(a){var b=[],c=LPTools.getOption(a,"identity",void 0),c=LPTools.getOption(a,"filter",S(c,"ffids"));a=LPTools.getOption(a,"invertIdentity",!1);for(var d in u){var e=
u[d];(!c||c[d]&&!a||void 0===c[d]&&a)&&b.push(new FormFillDisplay(e))}return b};LPProxy.getIdentities=function(){var a=[new AllIdentity];$.each(bg.g_identities,function(b,c){var d=new Identity(c);a.push(d)});return a};LPProxy.enableCurrentIdentity=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b];if(d.getID()===bg.g_identity){d.enable({reprompt:!1});break}}};LPProxy.enableIdentity=function(a){bg.lpevent("v_cid");bg.switch_identity(a._data.iid,!0)};LPProxy.getAccountClass=function(){var a=Constants.USER_FREE;
!0===bg.g_iscompanyadmin?a=Constants.USER_ENTERPRISE_ADMIN:"1"===bg.g_enterpriseuser?a=Constants.USER_ENTERPRISE:bg.g_premium_exp>LPTools.get_gmt_timestamp()&&(a=Constants.USER_PREMIUM);return a};LPProxy.getUser=function(){return new User(bg.g_username,LPProxy.getAccountClass(),this.getIdentities())};LPProxy.isEnterpriseUser=function(){var a=LPProxy.getAccountClass();return a===Constants.USER_ENTERPRISE||a===Constants.USER_ENTERPRISE_ADMIN};LPProxy.getCreditMonitoringData=function(a,b){var c=LPProxy.getBaseURL()+
"getCreditMonitoringData.php";LPPlatform.ajax({url:c,dataType:"text",success:m(b,a),error:j(b)})};LPProxy.getReceivedShareData=function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getReceivedShareInfo.php",dataType:"text",success:m(b,a),error:j(b)})};LPProxy.getSharedFolderData=function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getSharedFolderInfo.php",dataType:"text",success:m(b,function(b){a(b.folders)}),error:j(b)})};LPProxy.getSentShareData=function(a,b){LPPlatform.ajax({type:"POST",
url:LPProxy.getBaseURL()+"getSentShareInfo.php",dataType:"text",success:m(b,a),error:j(b)})};LPProxy.getItemShareData=function(a,b,c){LPPlatform.ajax({type:"POST",data:{aid:a},url:LPProxy.getBaseURL()+"getSentShareInfo.php",dataType:"text",success:m(c,b),error:j(c)})};var k=null;LPProxy.getToken=function(a,b){if(void 0!==a)null!==k?a(k):LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getCSRFToken.php",data:{token:k},success:function(b){k=b;a(k)},error:j(b)});else return k};LPProxy.deleteIdentity=
function(a){bg.BackgroundServer.identities.remove(a)};LPProxy.addIdentity=function(a){bg.BackgroundServer.identities.add(a)};LPProxy.saveIdentity=function(a){bg.BackgroundServer.identities.update(a)};LPProxy["import"]=function(){bg.lpevent("v_i");bg.openimport()};LPProxy["export"]=function(){bg.lpevent("v_e");bg.openexport()};LPProxy.openAllFavorites=function(){bg.lpevent("v_of");bg.openfavorites()};LPProxy.openBookmarklets=function(){bg.lpevent("v_bk");LPProxy.callAcctsIFrameCommand("bookmarklets")};
LPProxy.openHistory=function(){bg.lpevent("v_his");LPProxy.callAcctsIFrameCommand("history")};var W=function(a){var b=(new Date).getTime(),c=parseInt(bg.lpGetPref("reprompttime",0)),d=bg.get_last_reprompt_time();b>d&&b-d<=1E3*c?a():Topics.get(Topics.REPROMPT).publish(a)},ma=function(a){if(a){a instanceof Array||(a=[a]);for(var b=0,c=a.length;b<c;++b)if(bg.g_prompts[a[b]])return!0;return!1}return!0};LPProxy.reprompt=function(a,b){if(ma(LPTools.getOption(b,"types",null))){if("function"===typeof bg.singlefactor_reprompt)return bg.singlefactor_reprompt(function(){W(a,
b)},a),!0;W(a,b)}else a();return!1};var B=null;LPProxy.callAcctsIFrameCommand=function(a,b){bg.unlock_plug2web();var c={rand:1E3*Math.random(),command:a,version:LPProxy.getVersion(),newvault:1};b&&(c.commandid=b);B=LPTools.createElement("iframe","acctsiframe");B.src=-1!==document.location.href.indexOf("vault.php")?"iframe.php":"iframe.html";LPPlatform.addEventListener(B,"load",function(){B.contentWindow.goTo(LPProxy.getBaseURL()+"acctsiframe.php?"+$.param(c));LPTools.addClass(B,"loaded")});document.body.appendChild(B)};
LPProxy.closeIFrame=function(){B&&(document.body.removeChild(B),B=null)};LPProxy.getDeletedItems=function(a,b){var c=LPProxy.getBaseURL()+"getaccts.php",d={mobile:1,b64:1,shap:1};d.u=bg.g_username_hash;d.only_deleted=1;LPPlatform.ajax({type:"POST",url:c,data:d,dataType:"text",success:function(b){var c=[],d=[];b=atob(b);bg.parsemobile(b,b.length,-1,0,null,c,d,null,null,null,null,null,!0,!1,null,null,null,null,null,null,null,null,[],null,null,null,null,null,null,null);b=[];for(var h=0,l=c.length;h<
l;++h){var j=c[h];j.url=bg.AES.hex2url(j.url);"http://group"!==j.url&&b.push((new Account(j)).newDisplayObject())}c=0;for(h=d.length;c<h;++c)b.push((new Note(d[c])).newDisplayObject());d=LPProxy.assignItemsToGroups(b,!1);c=0;for(b=d.length;c<b;++c)d[c].setDeleted();a(d)},error:j(b)})};LPProxy.getSharedFolderMembers=function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getSharedFolderMembers.php",dataType:"text",data:{shareid:a.getID()},success:m(c,function(c){for(var e=[],f=c.users,
g=0,h=f.length;g<h;++g)e.push(new SharedFolderUser(f[g],a));c=c.groups;f=0;for(g=c.length;f<g;++f)e.push(new SharedFolderUserGroup(c[f],a));b(e)}),error:j(c)})};LPProxy.restoreDeletedItems=n(function(a,b,c,d){a={src:"website",fromwebsite:1,ajax:1,extjs:1,undelete:1,aid:H(a),token:k};b&&(a.sharedfolderid=b);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"show_website.php",data:a,dataType:"text",success:p(d,{accountundeleted:c,reload:c}),error:j(d)})});LPProxy.purgeDeletedItems=n(function(a,
b,c,d){a={src:"website",fromwebsite:1,ajax:1,extjs:1,purgeext:1,aid:H(a),token:k};b&&(a.sharedfolderid=b);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"show_website.php",data:a,dataType:"text",success:p(d,{accountpurged:c}),error:j(d)})});LPProxy.removeSharedFolderMember=n(function(a,b,c){var d={xmlr:1,token:k};a.isMissingSharedFolderUser()?$.extend(d,{msfdelete:1,id:a._sharedGroup.getID(),msfuser:a.getID(!0)}):$.extend(d,{update:1,id:a._sharedGroup.getID(),"delete":1,uid:a.getID(!0)});LPPlatform.ajax({type:"POST",
url:LPProxy.getBaseURL()+"share.php",dataType:"text",data:d,success:p(c,{ok:b}),error:j(c)})});LPProxy.getPublicKeys=function(a,b,c){for(var d={},e=0,f=a.length;e<f;++e){var g=a[e],h=g._data.username;g instanceof SharedFolderUserGroup&&(h=g._data.name);d[h]={type:g._data.type,id:g.getID()}}d={getpubkey:1,_dc:(new Date).getTime(),uid:JSON.stringify(d),jsonr:1};e=function(d){if(d.success){for(var e={},f={},g={},h=0;void 0!==d["pubkey"+h];){var j=d["pubkey"+h],k=d["uid"+h],n=d["username"+h],m=d["cgid"+
h];if(m){var p=g[m];void 0===p&&(p=[],g[m]=p);p.push({uid:k,cgid:m,username:n,pubkey:j})}else e[k]=j,f[n]={uid:k,pubkey:j};++h}h={};if(d.groupname){d=d.groupname.split(",");j=0;for(k=d.length;j<k;++j)h[d[j]]=!0}d=[];for(j=0;j<a.length;++j)k=a[j],k instanceof SharedFolderUserGroup?h[k.getName()]?(a.splice(j,1),--j,d.push(k)):k.users=g[k.getID()]:(k.pubkey=e[k.getID()],void 0===k.pubkey&&(n=f[k.getName()],k.pubkey=n.pubkey,k.setID(n.uid)));0<d.length&&dialogs.alert.open({title:Strings.translateString("Error"),
text:[Strings.translateString("The following user groups are empty and cannot be added."),Strings.translateString("Please try again once users have been added."),LPTools.buildDialogItemContainer(d)]});b(a)}else c(Strings.Vault.UNEXPECTED_ERROR),LPPlatform.logError("getpubkey returned the following unexepcted value for response: "+d.success)};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:d,dataType:"text",success:m(c,{nouser:function(a){c();dialogs.inviteFriends.open({emails:a.unknownusers.split(",")})},
"default":e,emptygroup:e,noshareerr:function(){c(Strings.translateString("Sorry, company policy prohibits use of this feature."))}}),error:j(c)})};var G=LPProxy,X,Y=function(a,b){var c=new bg.RSAKey;LPProxy.parsePublicKey(c,b);return c.encrypt(bg.AES.bin2hex(a))};X=n(function(a,b,c,d,e){LPProxy.getPublicKeys(b,function(){if(0<b.length){for(var f={id:a.getID(),update:1,add:1,sharename:a.getShareName(),name:a.getShareGroupName(),readonly:c.readonly?1:0,give:!c.hidePasswords?1:0,notify:c.notify?1:0,
canadminister:c.can_administer?1:0,token:k,xmlr:1},g=[],h=0,l=0,n=b.length;l<n;++l){var m=b[l];if(m instanceof SharedFolderUser)m.pubkey?(f["sharekey"+h]=Y(a.getKey(),m.pubkey),f["uid"+h]=m.getID(),f["cgid"+h]="",++h):g.push(m);else for(var m=m.users,r=0;r<m.length;++r){var q=m[r];q.pubkey?(f["sharekey"+h]=Y(a.getKey(),q.pubkey),f["uid"+h]=q.uid,f["cgid"+h]=q.cgid,++h):g.push(q)}}l=h=0;for(n=g.length;l<n;++l)m=g[l],m instanceof SharedFolderUser?(m._data.msfuser="1",f["msfuser"+h]=m.getID(),f["msfcgid"+
h]=""):(f["msfuser"+h]=m.uid,f["msfcgid"+h]=m.cgid),++h;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:f,dataType:"text",success:p(e,{useradded:function(){if(0<g.length){for(var a=LPTools.createElement("ul","bulletList"),b=0,c=g.length;b<c;++b){var e=g[b],e=e instanceof SharedFolderUser?e.getName():e.username;a.appendChild(LPTools.createElement("li",null,e))}dialogs.alert.open({title:Strings.translateString("No Sharing Support"),text:[Strings.translateString("The following users do not currently have sharing keys."),
Strings.translateString("They can generate sharing keys by logging into LastPass via the LastPass Internet Explorer, Firefox, or Google Chrome browser extensions, or by logging into the website and clicking on the Generate Sharing Keys link."),Strings.translateString("Once they do that this Shared Folder will become accessable to them."),a]})}d()}}),error:j(e)})}else e()},e)});G.addSharedFolderMembers=X;var G=LPProxy,na=n(r(function(a,b,c,d,e){var f={id:0,update:1,newusername:bg.g_username+"-"+a.getName(),
name:a.getShareGroupName(),token:k,xmlr:1},g=bg.get_random_password(),h=bg.get_key_iterations(bg.g_username),l=a._shareInfo.key=bg.make_lp_key_iterations(f.newusername,g,h);f.newhash=bg.make_lp_hash_iterations(l,g,h);g=new bg.RSAKey;LPProxy.parsePublicKey(g,e.pubkey);f.sharekey=a._shareInfo.sharekey=g.encrypt(bg.AES.bin2hex(l));f.sharename=a._shareInfo.sharename=bg.enccbc(a.getName(),l);a._shareInfo.sharekeyaes=LPProxy.encryptMobile(f.newhash,!0,l);if(0<b.length){f.adminuidcnt=b.length;e=0;for(g=
b.length;e<g;++e){var h=b[e],m=new bg.RSAKey;LPProxy.parsePublicKey(m,h.key);f["adminsharekey"+e]=m.encrypt(bg.AES.bin2hex(l));f["adminuid"+e]=h.uid}}LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:f,dataType:"text",success:p(d,{ok:function(b){a.setID(b.attr("id"));bg.g_sites[a.getID()]=a._data;bg.g_shares.push(a._shareInfo);bg.increment_local_accts_version();c()},createsharedfolderuserfailed:function(){d(Strings.translateString("Could not create shared folder"))}}),error:j(d)})}));
G.createSharedFolder=function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getSuperUserInfo.php",dataType:"text",success:m(c,function(d){na(a,d,b,c)}),error:j(c)})};LPProxy.deleteSharedFolder=n(function(a,b,c){var d=a.getID();a={id:d,"delete":1,token:k,xmlr:1};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:a,dataType:"text",success:p(c,{deleted:function(){delete bg.g_sites[d];b()}}),error:j(c)})});LPProxy.createCreditMonitoringProfile=function(a,b,c){var d=
{cmd:"enroll",xml:1};d.ffid=a.getID();$.extend(d,a.getFormData({firstname:!0,lastname:!0,birthday:!0,ssn:!0,address1:!0,address2:!0,address3:!0,city:!0,state:!0,country:!0,zip:!0,phone:!0}));LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"creditmon.php",data:d,dataType:"text",success:p(c,{1:function(){Topics.get(Topics.SUCCESS).publish("Enrolled in credit monitoring.");Topics.get(Topics.ENROLLED_CREDIT_MONITORING).publish();b()},"":function(a){c(a.attr("reason2"))}}),error:j(c)})};LPProxy.sendVerificationEmail=
n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"settings.php",data:{testemail:1,email:a,extra:"verifysharing",token:k},success:b,error:j(c)})});var N=function(a,b,c,d,e){var f={};f.aid=a;b&&(f.sharedfolderid=b);LPPlatform.ajax({type:"POST",url:c,data:f,dataType:"text",success:m(e,function(a){for(var b=0,c=a.length;b<c;++b){var e=a[b];a[b]={value:e[0],date:e[1],whom:2<e.length?e[2]:""}}d(a)}),error:j(e)})};LPProxy.getPasswordHistory=function(a,b,c,d){N(a,b,LPProxy.getBaseURL()+
"getPasswordHist.php",c,d)};LPProxy.getUsernameHistory=function(a,b,c,d){N(a,b,LPProxy.getBaseURL()+"getUsernameHist.php",c,d)};LPProxy.getNoteHistory=function(a,b,c,d){N(a,b,LPProxy.getBaseURL()+"getNoteHist.php",c,d)};LPProxy.getSecurityChallengeScore=function(a){bg.get_securityChallengeScore(a)};LPProxy.getSharedFolderRestrictions=function(a,b,c){var d={};d.shareid=a.getShareID();a instanceof SharedFolderUser?d.uid=a.getID():d.cgid=a.getID();LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+
"getSharedFolderRestrictions.php",data:d,dataType:"text",success:m(c,b),error:j(c)})};LPProxy.updateSharedFolderRestrictions=n(function(a,b,c,d){a={id:a._sharedGroup.getID(),edit:1,limit:1,token:k,aids:b.aids,numaids:0<b.aids.length?b.aids.split(",").length:0,additionaluids:b.additionaluids,hidebydefault:b.hidebydefault?1:0,uid:a.getID(!0)};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:a,dataType:"text",success:c,error:j(d)})});LPProxy.unlinkAccount=n(function(a,b,c){var d=
{unlink:1};d.uid=a;d.token=k;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:d,dataType:"text",success:p(c,{ok:b}),error:j(c)})});var G=LPProxy,oa=r(function(a,b,c,d,e,f,g,h){d=new bg.RSAKey;LPProxy.parsePublicKey(d,h.pubkey);h=d.encrypt(bg.AES.bin2hex(b));d={id:0,update:1,link:1,xml:1};d.token=a.attr("token");d.newusername=e.linkedEmail;d.newhash=c;d.sharekey=h;d.sharename=LPProxy.encryptWithKey(e.linkedEmail,b);d.name=e.linkedEmail;d.uid=a.attr("uid");d.linkvalid=1;LPPlatform.ajax({type:"POST",
url:LPProxy.getBaseURL()+"share.php",data:d,dataType:"text",success:p(g,{ok:f}),error:j(g)})});G.linkAccount=function(a,b,c){var d=bg.get_key_iterations(a.linkedEmail);bg.make_lp_key_hash_iterations(a.linkedEmail,a.linkedPassword,d,function(e,f){var g={verifylink:1,outofbandsupported:1,outofbandrequest:0,outofbandretry:0,xml:1};g.username=a.linkedEmail;g.hash=f;g.iterations=d;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"login.php",data:g,dataType:"text",success:p(c,{ok:function(g){oa(g,
e,f,d,a,b,c)}}),error:j(c)})})};LPProxy.refreshSites=function(){bg.refreshsites()};LPProxy.getLinkedAccount=function(){return O};LPProxy.updateSharedFolderMemberPermissions=n(function(a,b,c,d){a={cmd:"edit",xml:1,token:k,shareid:a,request:JSON.stringify(b)};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"editSharedFolderUsers.php",data:a,dataType:"text",success:p(d,{ok:c}),error:j(d)})});LPProxy.stopStartDownloadingFolder=n(function(a,b,c,d){a={id:a.getID(),token:k,xmlr:1};b?a.startdownloading=
1:a.stopdownloading=1;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:a,dataType:"text",success:p(d,{ok:c}),error:j(d)})});var Z=function(a,b,c,d,e){c=b.getFieldPostData(c,!0);c.aid=b.getID();c.auto=1;c[a]=1;a=$.param(c);c=b.getShareInfo();var f="";c&&(f=$.param({sharedfolderid:c.id}));bg.saveFields(a,f,{aid:b.getID()},d,e)};LPProxy.addField=function(a,b,c,d){Z("add",a,b,c,d)};LPProxy.deleteField=function(a,b,c,d){Z("delete",a,b,c,d)};LPProxy.autoChangePassword=function(a){bg.editAid(a,
null,null,"1")};LPProxy.getPreference=function(a,b){var c=bg.lpGetPref(a,b);if(null!==b&&typeof c!==typeof b)switch(typeof b){case "boolean":return"true"===c||1===parseInt(c);case "number":return-1===c.indexOf(".")?parseInt(c):parseFloat(c);case "object":return JSON.parse(c)}return c};var aa=function(a,b){switch(typeof b){case "object":b=JSON.stringify(b)}bg.lpPutUserPref(a,b)};LPProxy.setPreferences=function(a,b){switch(typeof a){case "object":for(var c in a)aa(c,a[c]);bg.lpWriteAllPrefs();break;
case "string":aa(a,b),bg.lpWriteAllPrefs()}};LPProxy.fillSite=function(a){bg.get_selected_tab_data(null,function(b){bg.setcurrenttabid(b.id);bg.setcurrenturl(b.url);bg.lpevent("m_mf");bg.fillaid(a.getID(),!0)})};LPProxy.fillProfile=function(a){bg.lpevent("m_ff");bg.fillform(a.getID())};r=LPProxy;G=s(function(a){bg.addAttach(function(b){if(b.name&&0<b.name.length){var c=b.name;b=b.bytes;var d=bg.check_filename_badchars(c);d===bg.FILENAME_FRAGMENT_BAD_SHELL_CHARS?Topics.get(Topics.ERROR).publish(Strings.translateString("Suspicious characters found in selected filename, will not process it")):
d===bg.FILENAME_FRAGMENT_BAD_CONTROL_CHARS?Topics.get(Topics.ERROR).publish(Strings.translateString("Control characters found in selected filename, will not process it")):a(new Attachment({filename:c,id:Math.floor(99999*Math.random()).toString(),mimetype:bg.get_mimetype_from_filename(c),bytes:b}))}})});r.addAttachment=G;LPProxy.openAttachment=s(function(a){LPPlatform.openAttachment(a)});LPProxy.saveAttachment=s(function(a){LPPlatform.saveAttachment(a)});LPProxy.openAll=function(a){for(var b=[],c=
0,d=a.length;c<d;++c){var e=a[c];e instanceof Account&&b.push(e._data)}bg.openAllSites(b)};LPProxy.getDomain=function(a){return bg.lp_gettld_url(a)};LPProxy.addToFavorites=function(a,b,c){a=H(a);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"groups.php",data:{aids:a,newfavaids:a,xml:1},dataType:"text",success:p(c,{ok:b}),error:j(c)})};LPProxy.restoreDeletedSharedFolder=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:{id:a.getID(),undelete:1,token:k,
xml:1},success:b,error:j(c)})});LPProxy.purgeDeletedSharedFolder=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:{id:a.getID(),purge:1,token:k,xml:1},success:b,error:j(c)})});var P=function(a){for(var b=[],c=0,d=a.length;c<d;++c)b.push(a[c].getID());return b};LPProxy.changePasswords=function(a,b,c,d){bg.changePassword(a.getFormData([]).password,P(b),!1,c,d)};var ba=function(a,b,c){for(var d=[],e=0;e<c;e++)d.push(a.attr(b+e));return d};LPProxy.inviteFriends=
function(a,b,c){for(var d={cmd:"invite",numemails:a.length},e=0,f=a.length;e<f;++e)d["email"+e]=a[e].getName();LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showshare.php",data:d,dataType:"text",success:p(c,{inviteack:function(d){var e=a.length;parseInt(d.attr("numsent"))===e?b():(e=parseInt(d.attr("numalready")),0<e?(d=ba(d,"emailalready",e).join(", "),c(Strings.translateString("You have already invited the following friends: %1. Please send them a reminder using your personal email as the email invitation sent by LastPass might not have reached them.",
d))):(e=parseInt(d.attr("numspam")),0<e&&(d=ba(d,"emailspam",e).join(", "),c(Strings.translateString("The following friends have marked your invitations as spam: %1.",d)))))}}),error:j(c)})};s=LPProxy;r=n(function(a,b,c){a=$.extend(a,{action:"get_pubkey",token:k});LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:a,dataType:"text",success:m(c,function(a){a.errors instanceof Array&&0<a.errors.length?c(Strings.translateString("User is missing sharing keys, please ask them to login to become an emergency contact.")):
(a.errors&&delete a.errors,a.noemail instanceof Array&&0<a.noemail.length&&(dialogs.inviteFriends.open({emails:a.noemail}),delete a.noemail),LPTools.hasProperties(a)?b(a):c())}),error:j(c)})});s.getEmergencyAccessPublicKeys=r;var ca=n(function(a,b,c,d,e){a=new bg.RSAKey;LPProxy.parsePublicKey(a,c);c=a.encrypt(bg.AES.bin2hex(LPProxy.getLocalKey()));LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"update_sharee",semail:b.username,enc_key:c,prio:1,hours:b.hours_to_override,
token:k},dataType:"text",success:m(e,{enterprise:function(){e(Strings.translateString("Sorry, LastPass Enterprise users can not act as emergency contacts."))},"default":d}),error:j(e)})});LPProxy.updateEmergencyAccessRecipient=function(a,b,c,d){ca(a,b,a._data.publickey,c,d)};LPProxy.addEmergencyAccessRecipient=function(a,b,c){LPProxy.getEmergencyAccessPublicKeys({emails:a.getName()},function(d){ca(a,a._data,d[a.getName()],b,c)},c)};s=LPProxy;r=n(function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+
"legacy_helper.php",data:{action:"get_sharees",lemail:bg.g_username,token:k},dataType:"text",success:m(b,function(b){for(var d=[],e=0,f=b.length;e<f;++e){var g=b[e];if(g.username){g.override_date&&(g.override_date=new Date(g.override_date));var h=z[g.username];h?$.extend(h._data,g):(h=new EmergencyAccessRecipient(g),LPProxy.addItem(h));d.push(h.newDisplayObject())}}a(d)}),error:j(b)})});s.getEmergencyAccessRecipientInfo=r;s=LPProxy;r=n(function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+
"legacy_helper.php",data:{action:"get_sharers",token:k},dataType:"text",success:m(b,function(b){for(var d=[],e=0,f=b.length;e<f;++e){var g=b[e];if(g.username){g.override_date&&(g.override_date=new Date(g.override_date));var h=I[g.username];h?$.extend(h._data,g):(h=new EmergencyAccessSharer(g),LPProxy.addItem(h));d.push(h.newDisplayObject())}}a(d)}),error:j(b)})});s.getEmergencyAccessSharerInfo=r;LPProxy.acceptEmergencyAccessOffer=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+
"legacy_helper.php",data:{action:"accept_offer",email:a.getName(),token:k},dataType:"text",success:m(c,b),error:j(c)})});LPProxy.declineEmergencyAccessOffer=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"decline_offer",email:a.getName(),token:k},dataType:"text",success:m(c,b),error:j(c)})});LPProxy.revokeEmergencyAccessOffer=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"revoke_offer",
email:a.getName(),token:k},dataType:"text",success:m(c,b),error:j(c)})});var s=LPProxy,pa=n(function(a,b,c,d){var e=new bg.RSAKey;LPProxy.parsePrivateKey(e);e=e.decrypt(b.enc_key);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"link",name:a.getName(),legacy:1,sharekey:b.enc_key,sharename:LPProxy.encryptWithKey(a.getName(),bg.AES.hex2bin(e)),token:k},dataType:"text",success:p(d,{ok:function(){LPProxy.refreshSites();Topics.get(Topics.SUCCESS).publish(Strings.translateString("Access granted"));
c()},linked:function(){d(Strings.translateString("This account is already linked"))},denied:function(){d(Strings.translateString("You do not have permission to link this account"))}}),error:j(d)})});r=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"confirm",lemail:a.getName(),token:k},dataType:"text",success:m(c,{success:function(){Topics.get(Topics.SUCCESS).publish(Strings.translateString("Access will be granted on %1",a.getAccessDateAsString()))},
allowed:function(d){pa(a,d,b,c)}}),error:j(c)})});s.requestEmergencyAccess=r;LPProxy.unlinkEmergencyAccessAccount=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"unlink",lemail:a,token:k},dataType:"text",success:m(c,b),error:j(c)})});LPProxy.denyEmergencyAccess=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"deny_access",email:a,token:k},dataType:"text",success:m(c,{success:b,failed:function(){}}),
error:j(c)})});LPProxy.getVersion=function(){return bg.lpversion};s=LPProxy;r=n(function(a,b){var c=new bg.RSAKey;bg.generate_key(c,function(c){var e=bg.encode_public_key(c);c="LastPassPrivateKey<"+bg.encode_private_key(c)+">LastPassPrivateKey";var f=LPProxy.getLocalKey(),g=bg.AES.bin2hex(atob(bg.AES.Encrypt({pass:f+f.substring(0,16),data:c,b64:!0,bits:256,mode:"cbc"}))).toUpperCase();LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"uploadrsakeys_website.php",dataType:"text",data:{privatekeyenc:g,
publickey:e,token:k,from:"generatesharingkeys.php",userkeyhexhash:bg.SHA256(bg.AES.bin2hex(f)),privatekeyenchexhash:bg.SHA256(g)},success:p(b,{ok:function(){bg.rsaprivatekeyhex=g;Topics.get(Topics.SUCCESS).publish(Strings.translateString("Sharing keys generated."));a()}}),error:j(b)})})});s.generateSharingKeys=r;LPProxy.deleteCreditMonitoringAlert=n(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"creditmon.php",dataType:"text",data:{src:"website",cmd:"deletealert",id:a,token:k,
_dc:(new Date).getTime()},success:p(c,{ok:b}),error:j(c)})})})();
